<html>

<head>
    <meta charset="UTF-8">
    <title>Tents and Trees Puzzles Solver</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
    <p class="size_input" align="center">
        Map Size:
        <input id="width" type="number" min="4" max="16" step="1" value="4" /> ×
        <input id="length" type="number" min="4" max="16" step="1" value="4" />
        <button id="create_grid" class="btn" type="button" onclick="create();">Create</button>
        <button id="solve" class="btn" type="button" onclick="solve();">Solve</button>
    </p>
    <p class="demo">
        <button type="button" class="btn" onclick="demo6_6();">Demo 6×6</button>
        <button type="button" class="btn" onclick="demo8_8();">Demo 8×8</button>
        <button type="button" class="btn" onclick="demo16_16();">Demo 16×16</button>
        <button type="button" class="btn" onclick="demo17_17();">Demo 17×17</button>
    </p>
    <p>1. Click <a onclick="create();">Create</a> to generate a map<br>2. Click the cell to place a tree</p>
    <div id="map"></div>
    <div id="result"></div>
</body>
<script src="solver.js"></script>
<script>
    var treeMap = [];
    var topHints = [];
    var leftHints = [];
    var resultDiv = document.getElementById("result");

    function demo6_6() {
        var trees = [
            [0, 1, 0, 1, 0, 0],
            [0, 0, 0, 0, 1, 0],
            [1, 0, 1, 0, 0, 0],
            [0, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0]
        ];
        var hints_top = [2, 0, 2, 0, 2, 1];
        var hints_left = [2, 1, 1, 2, 1, 0];
        setupDemo(trees, hints_top, hints_left);
    }

    function demo17_17() {
        var trees = [
            [1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0],
            [0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0],
            [0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,1],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,1,1,0,0,1,0,1,0,0,0,0,1,0,1,0,0],
            [0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],
            [1,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0],
            [0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,1,0],
            [1,0,0,0,1,0,1,0,0,1,0,0,0,0,0,0,1],
            [0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0],
            [0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1],
            [1,0,0,1,0,0,0,0,1,0,1,1,0,1,0,0,0],
            [0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0]
        ];
        var hints_top = [5,3,4,2,4,3,4,3,5,1,5,3,2,4,2,1,7];
        var hints_left = [6,1,3,4,2,3,3,4,1,6,3,3,4,1,5,4,5];
        setupDemo(trees, hints_top, hints_left);
    }

    function setupDemo(trees, hints_top, hints_left) {
        var length = trees.length;
        var width = trees[0].length;
        document.getElementById("width").value = width;
        document.getElementById("length").value = length;
        create();
        setTopHints(hints_top);
        setLeftHints(hints_left);
        setTrees(trees);
    }

    function demo8_8() {
        var trees = [
            [0, 0, 0, 1, 0, 1, 0, 0],
            [0, 0, 1, 0, 0, 0, 1, 0],
            [1, 0, 0, 0, 0, 0, 0, 0],
            [0, 1, 0, 0, 0, 0, 0, 1],
            [0, 0, 1, 0, 0, 0, 0, 0],
            [1, 0, 0, 0, 0, 0, 1, 0],
            [0, 0, 0, 0, 1, 0, 0, 1],
            [0, 0, 1, 0, 0, 0, 0, 0]
        ];
        var hints_top = [2, 2, 2, 2, 1, 1, 1, 2];
        var hints_left = [2, 2, 1, 2, 1, 2, 1, 2];
        setupDemo(trees, hints_top, hints_left);
    }

    function demo16_16() {
        var trees = [
            [0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0],
            [0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0],
            [0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0],
            [1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0],
            [0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
            [0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0],
            [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
            [0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0],
            [0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0],
            [1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        ];
        var hints_top = [3, 3, 2, 5, 3, 3, 4, 1, 6, 0, 5, 2, 4, 3, 2, 5];
        var hints_left = [6, 1, 4, 3, 3, 3, 4, 2, 4, 2, 4, 2, 5, 1, 5, 2];
        setupDemo(trees, hints_top, hints_left);
    }

    function setTopHints(hints) {
        for (var i = 0; i < hints.length; i++) {
            document.getElementById("top_hint_" + i).value = hints[i];
        }
    }

    function setLeftHints(hints) {
        for (var i = 0; i < hints.length; i++) {
            document.getElementById("left_hint_" + i).value = hints[i];
        }
    }

    function setTrees(trees) {
        var rowCount = trees.length;
        var columnCount = trees[0].length;
        for (var row = 0; row < rowCount; row++) {
            for (var column = 0; column < columnCount; column++) {
                if (trees[row][column] == 1) {
                    setTree(row, column);
                }
            }
        }
    }

    function solve() {
        var rowCount = treeMap.length;
        var columnCount = treeMap[0].length;
        topHints = new Array(columnCount);
        leftHints = new Array(rowCount);
        for (var column = 0; column < columnCount; column++) {
            topHints[column] = parseInt(document.getElementById("top_hint_" + column).value);
        }
        for (var row = 0; row < rowCount; row++) {
            leftHints[row] = parseInt(document.getElementById("left_hint_" + row).value);
        }
        resultDiv.innerHTML = solve2(treeMap, topHints, leftHints);
    }

    function setTree(i, j) { //i = horizontal, j = vertical
        var isTree = treeMap[i][j];
        var invertIsTree = !isTree;
        treeMap[i][j] = invertIsTree;
        var grid = document.getElementById(i + "_" + j);
        grid.classList.toggle("tree");
    }

    function create() {
        resultDiv.innerHTML = "";
        var map = document.getElementById("map");
        var width = parseInt(document.getElementById("width").value);
        var length = parseInt(document.getElementById("length").value);

        topHints = new Array(width);
        leftHints = new Array(length);
        treeMap = new Array(length);
        for (var i = 0; i < length; i++) {
            treeMap[i] = new Array(width);
            treeMap[i].fill(false);
        }

        const squareSize = (95 / (width + 1));
        var topHintsHtml = new Array(width);
        for (var i = 0; i < width; i++) {
            topHintsHtml[i] = `<div class="no_border_square_top" style="width:${squareSize}%; padding-bottom:${squareSize}%">
			  <div class="numTents">
					<p class="top_num_tents" ><input type="number" id="top_hint_${i}"
       					min="0"
       					max="${length}"
       					step="1"
       					value="0"/>
       				</p>
				</div>
			</div>`;
        }
        var mapHtml = `<div class="no_border_square_top" style="width:${squareSize}%; padding-bottom:${squareSize}%">
    				<div class="corner">
    				</div>
				</div>` + topHintsHtml.join("");
        for (var i = 0; i < length; i++) {
            mapHtml += `<div class="no_border_square_front" style="width:${squareSize}%; padding-bottom:${squareSize}%">
			  <div class="numTents">
					<p class="top_num_tents" ><input type="number" id="left_hint_${i}"
       					min="0"
       					max="${width}"
       					step="1"
       					value="0"/>
       				</p>
				</div>
			</div>`;
            for (var j = 0; j < width; j++) {
                mapHtml += `<div class="square" id="${i}_${j}" onclick="setTree(${i}, ${j});" style="width:${squareSize}%; padding-bottom:${squareSize}%">
              <div class="content">
              </div>
            </div>`;
            }
        }
        map.innerHTML = mapHtml;
    }
</script>

</html>