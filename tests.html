<html>
<header>
    <link rel="stylesheet" type="text/css" href="style.css" />
</header>
<meta charset="UTF-8">

<body style="font-family: 'Courier New', Courier, monospace">
    <div id="result"></div>
</body>
<script src="solver.js"></script>
<script>
    var resultDiv = document.getElementById("result");
    runTest();

    function runTest() {
        test1();
        test2();
        test3();
        integrationTest1();
    }

    function test1() {
        var tentMap = [
            [0, 4, 2],
            [4, 3, 3],
            [1, 4, 3]
        ];
        var topHints = [2, 0, 1];
        var leftHints = [2, 0, 1];
        var expected = [
            [1, 4, 1],
            [4, 3, 3],
            [1, 4, 3],
        ]
        var cellTentMap = convertToCells(tentMap);
        resultDiv.innerHTML += "test PlaceExplicitTents()<br>";
        resultDiv.innerHTML += stringify(cellTentMap) + "<br>";
        PlaceExplicitTents(cellTentMap, topHints, leftHints);
        resultDiv.innerHTML += stringify(cellTentMap) + "<br>";
        equal(cellTentMap, convertToCells(expected));
    }

    function test2() {
        var tentMap = [
            [0, 0, 2],
            [4, 0, 4],
            [3, 4, 2]
        ];
        var topHints = [0, 1, 1];
        var leftHints = [0, 1, 1];
        var expected = [
            [3, 3, 3],
            [4, 0, 4],
            [3, 4, 2],
        ]
        var cellTentMap = convertToCells(tentMap);
        resultDiv.innerHTML += "test RemoveZeroColumnRow()<br>";
        resultDiv.innerHTML += stringify(cellTentMap) + "<br>";
        RemoveZeroColumnRow(cellTentMap, topHints, leftHints);
        resultDiv.innerHTML += stringify(cellTentMap) + "<br>";
        equal(cellTentMap, convertToCells(expected));
    }

    function test3() {
        var tentMap = [
            [4, 0, 3, 4],
            [3, 0, 4, 0],
            [2, 3, 1, 0],
            [4, 3, 2, 4]
        ];
        var expected = [
            [4, 1, 3, 4],
            [3, 0, 4, 1],
            [1, 3, 1, 0],
            [4, 3, 2, 4]
        ]
        var cellTentMap = convertToCells(tentMap);
        resultDiv.innerHTML += "test PlaceTentNextToIsolatedTree()<br>";
        resultDiv.innerHTML += stringify(cellTentMap) + "<br>";
        PlaceTentNextToIsolatedTree(cellTentMap);
        resultDiv.innerHTML += stringify(cellTentMap) + "<br>";
        equal(cellTentMap, convertToCells(expected));
    }

    function convertToCells(map) {
        var rowCount = map.length;
        var columnCount = map[0].length;
        var cells = new Array(rowCount);
        for (var i = 0; i < rowCount; i++) {
            cells[i] = new Array(columnCount);
            for (var j = 0; j < columnCount; j++) {
                cells[i][j] = new Cell();
                cells[i][j].setType(map[i][j]);
            }
        }
        return cells;
    }

    function integrationTest1() {
        var treeMap = [
            [false, false, false, false],
            [false, false, false, false],
            [false, true, true, false],
            [false, false, false, false]
        ];
        var topHints = [0, 1, 0, 1];
        var leftHints = [0, 0, 1, 1];
        var expected =
            "input:<br><div class='text-map'>____<br>____<br>_TT_<br>____<br></div>is valid: true<br><br>step 1: ignore zero columns and rows<br><div class='text-map'>□□□□<br>□□□□<br>□TT_<br>□_□_<br></div>is solved: false<br><br>step 2: exclude open land (no adjacent tree)<br><div class='text-map'>□□□□<br>□□□□<br>□TT_<br>□_□□<br></div>is solved: false<br><br>step 3: fill in tents<br><div class='text-map'>□□□□<br>□□□□<br>□TT▲<br>□▲□□<br></div>is solved: true<br><br>";
        var rowCount = leftHints.length;
        var columnCount = topHints.length;
        resultDiv.innerHTML += "test solve2()<br>";
        var actual = solve2(treeMap, topHints, leftHints);
        stringEqual(actual, expected);
    }

    function stringEqual(actual, expected) {
        if (actual != expected) {
            resultDiv.innerHTML += "actual: " + actual + "<br>";
            resultDiv.innerHTML += "expected: " + expected + "<br>";
            console.log("actual: " + actual);
            console.log("expected: " + expected);
        } else {
            resultDiv.innerHTML += "pass<br>";
        }
        resultDiv.innerHTML += "<br>";
    }

    function equal(actual, expected) {
        var areEqual = true;
        for (var row = 0; row < actual.length; row++) {
            for (var column = 0; column < actual[row].length; column++) {
                if (actual[row][column].type != expected[row][column].type) {
                    areEqual = false;
                    resultDiv.innerHTML += "mismatch at [" + row + ", " + column + "]<br>";
                }
            }
        }
        if (areEqual) {
            resultDiv.innerHTML += "pass<br>";
        }
        resultDiv.innerHTML += "<br>";
    }
</script>

</html>